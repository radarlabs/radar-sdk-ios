name: Create Linear Issues from GitHub Issues

on:
  issues:
    types: [opened]

jobs:
  create-linear-ticket:
    runs-on: ubuntu-latest
    steps:
      - name: Create Linear Issue
        uses: actions/github-script@v7
        env:
          LINEAR_API_KEY: ${{ secrets.LINEAR_API_KEY }}
          LINEAR_TEAM_ID: ${{ secrets.LINEAR_TEAM_ID }}
        with:
          script: |
            const linearQuery = `
              mutation IssueCreate($teamId: String!, $title: String!, $description: String!) {
                issueCreate(input: {
                  teamId: $teamId,
                  title: $title,
                  description: $description
                }) {
                  success
                  issue {
                    id
                    identifier
                    url
                  }
                }
              }
            `;

            const variables = {
              teamId: process.env.LINEAR_TEAM_ID,
              title: context.payload.issue.title,
              description: `${context.payload.issue.body}\n\nOriginal GitHub Issue: ${context.payload.issue.html_url}`
            };

            const response = await fetch('https://api.linear.app/graphql', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${process.env.LINEAR_API_KEY}`
              },
              body: JSON.stringify({
                query: linearQuery,
                variables: variables
              })
            });

            const data = await response.json();

            if (data.data?.issueCreate.success) {
              const linearIssue = data.data.issueCreate.issue;
              console.log(`Linear issue created: ${linearIssue.identifier}`);
            } else {
              throw new Error('Failed to create Linear issue');
            }