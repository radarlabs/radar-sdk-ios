# When a new release is created on GitHub, this workflow builds the SDK as an XCFramework,
# generates the API documents, and pushes a CocoaPods update.
name: Radar SDK iOS Release

on:
  # Triggered when a new release is tagged in GitHub.
  release:
    types: [ published ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:

  build:
    runs-on: macos-latest

    steps:
      - uses: maxim-lobanov/setup-xcode@v1
        with: 
          xcode-version: '16.0'
      - name: Checkout
        uses: actions/checkout@v2

      - name: Deploy to Cocoapods
        run: |
          set -eo pipefail
          pod lib lint --allow-warnings RadarSDK.podspec
          pod trunk push --allow-warnings RadarSDK.podspec
          pod lib lint --allow-warnings RadarSDKMotion.podspec
          pod trunk push --allow-warnings RadarSDKMotion.podspec
          pod lib lint --allow-warnings RadarSDKLocationPermission.podspec
          pod trunk push --allow-warnings RadarSDKLocationPermission.podspec
        env:
          COCOAPODS_TRUNK_TOKEN: ${{ secrets.COCOAPODS_TRUNK_TOKEN }}